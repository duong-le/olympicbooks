<app-cart-empty *ngIf="!cart?.totalQuantity"></app-cart-empty>

<div class="container" *ngIf="cart?.totalQuantity">
  <div nz-row [nzGutter]="[16, 16]">
    <div nz-col nzXl="16" nzMd="12" nzXs="24">
      <div nz-row [nzGutter]="[0, 16]">
        <div nz-col nzSpan="24" *ngFor="let item of cart?.items | keyvalue">
          <nz-card [nzTitle]="item?.value[0]?.product?.shop?.name" [nzLoading]="isLoading">
            <div *ngFor="let cartItem of item.value; let last = last">
              <nz-card nzType="inner" [nzLoading]="isLoading" [style]="!last ? 'margin-bottom: 16px': '' ">
                <div nz-row nzJustify="space-between" nzAlign="middle" [nzGutter]="[0, 16]">
                  <div nz-col nzXl="4" nzXs="8">
                    <a [routerLink]="['/products', cartItem?.product.id]">
                      <img [src]="cartItem?.product?.images[0]?.imgUrl" height="80" width="80"
                           (load)="onLoadImage($event)">
                    </a>
                  </div>
                  <div nz-col nzXl="9" nzXs="16">
                    <a [routerLink]="['/products', cartItem?.product.id]">
                      <h3 class="name">{{ cartItem?.product.title }}</h3>
                    </a>
                  </div>
                  <div nz-col nzXl="3">
                    <nz-input-number [(ngModel)]="cartItem.quantity" [nzMin]="minQty" [nzMax]="maxQty" [nzStep]="1"
                                     (ngModelChange)="changeQuantity(cartItem?.id, cartItem?.quantity)"
                                     [nzDisabled]="isDisabled">
                    </nz-input-number>
                  </div>
                  <div nz-col nzXl="3">
                    <span class="price">
                      {{ cartItem?.quantity * cartItem?.product.price | price }}
                    </span>
                  </div>
                  <div nz-col>
                    <button nz-button nzType="text" (click)="deleteCartItem(cartItem.id)" [disabled]="isDisabled">
                      <i nz-icon nzType="delete" nzTheme="twotone"></i>
                    </button>
                  </div>
                </div>
              </nz-card>
            </div>
          </nz-card>
        </div>
      </div>
    </div>

    <div nz-col nzXl="8" nzMd="12" nzXs="24">
      <div nz-row [nzGutter]="[0, 16]">
        <div nz-col nzSpan="24">
          <nz-card [nzLoading]="isLoading" nzTitle="Mã giảm giá" [nzBordered]="false">
            <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
              <input type="text" nz-input placeholder="Nhập mã giảm giá">
            </nz-input-group>
            <ng-template #suffixIconButton>
              <button nz-button nzType="primary" nzSearch [disabled]="isDisabled">
                <i nz-icon nzType="gift"></i>
              </button>
            </ng-template>
          </nz-card>
        </div>

        <div nz-col nzSpan="24">
          <nz-card [nzLoading]="isLoading" nzTitle="Đơn hàng" [nzBordered]="false">
            <div nz-row nzJustify="space-between" class="summary-row">
              <div nz-col>
                <span>Tạm tính</span>
              </div>
              <div nz-col>
                <span class="price">{{ cart?.orderValue | price }}</span>
              </div>
            </div>

            <div nz-row nzJustify="space-between" class="summary-row">
              <div nz-col>
                <span>Giảm giá</span>
              </div>
              <div nz-col>
                <span class="price">{{ discountValue | price }}</span>
              </div>
            </div>

            <nz-divider></nz-divider>

            <div nz-row nzJustify="space-between" class="summary-row">
              <div nz-col>
                <span>Tổng cộng</span>
              </div>
              <div nz-col>
                <span class="price">{{ cart?.orderValue | price }}</span>
              </div>
            </div>
            <button nz-button nzType="primary" routerLink="/checkout" nzBlock [disabled]="isDisabled">
              Xác nhận
            </button>
          </nz-card>
        </div>
      </div>
    </div>
  </div>
</div>